{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "epl",
  "patterns": [
    {
      "include": "#comments"
    },
    {
      "include": "#events"
    },
    {
      "include": "#monitor"
    },
    {
      "include": "#statement"
    }
  ],
  "repository": {
    "events": {
      "begin": "(?=\\bevent)",
      "end": "\\}",
      "patterns": [
        {
          "begin": "\\b(event)\\s+([_a-zA-Z][_a-zA-Z0-9]*)\\b",
          "beginCaptures": {
            "1": {
              "name": "entity.name.type.epl"
            },
            "2": {
              "name": "entity.name.class.epl"
            }
          },
          "end": "\\{",
          "patterns": [
            {
              "include": "#comments"
            }
          ]
        },
        {
          "include": "#types"
        },
        {
          "include": "#comments"
        }
      ]
    },
    "action": {
      "begin": "(?=\\baction)",
      "end": "\\}",
      "patterns": [
        {
          "begin": "\\b(action)\\s+([_a-zA-Z][_a-zA-Z0-9]*)\\b",
          "beginCaptures": {
            "1": {
              "name": "entity.name.type.epl"
            },
            "2": {
              "name": "entity.name.function.epl"
            }
          },
          "end": "\\)",
          "patterns": [
            {
              "include": "#types"
            },
            {
              "include": "#comma"
            },
            {
              "include": "#arrays"
            },
            {
              "include": "#strings"
            }
          ]
        },
        {
          "begin": "\\{",
          "end": "\\}",
          "patterns": [
            
            {
              "include": "#control-keywords"
            },
            {
              "include": "#arrays"
            },
            {
              "include": "#assignment"
            },
            {
              "include": "#types"
            },
            {
              "include": "#strings"
            },
            {
              "include": "#comments"
            }
          ]
        }      
      ]
    },
    "monitor": {
      "begin": "(?=\\bmonitor)",
      "end": "\\}",
      "patterns": [
        {
          "begin": "\\b(monitor)\\s+([_a-zA-Z][_a-zA-Z0-9]*)\\b",
          "beginCaptures": {
            "1": {
              "name": "entity.name.type.epl"
            },
            "2": {
              "name": "entity.name.class.epl"
            }
          },
          "end": "\\{",
          "patterns": [
            {
              "include": "#comments"
            }
          ]
        },
        {
          "include": "#action"
        },
        {
          "include":"#codeblock"
        }
      ]
    },
    "types": {
      "patterns": [
        {
          "begin": "(?=\\b(integer|float|boolean|string|any|dictionary|sequence))",
          "end": "(?=\\;)",
          "patterns": [
            {
              "begin": "(integer|float|boolean|string|any)\\s+([_a-zA-Z][_a-zA-Z0-9]*)\\s*",
              "beginCaptures": {
                "1": {
                  "name": "entity.name.type.epl"
                },
                "2": {
                  "name": "variable.language.epl"
                }
              },
              "end": "(?=\\;)",
              "patterns": [
                {
                  "include": "#assignment"
                },
                {
                  "include": "#strings"
                },
                {
                  "include": "#control-keywords"
                },
                {
                  "comment": "This allows the any to be assigned to",
                  "include": "#types"
                }
              ]
            },
            {
              "begin": "(?=(\\bsequence|dictionary\\b))",
              "end": "(?=\\;)",
              "patterns": [
                {
                  "begin": "(sequence|dictionary)\\s*\\<",
                  "beginCaptures": {
                    "1": {
                      "name": "entity.name.type.epl"
                    }
                  },
                  "end": "(?=\\>)",
                  "patterns": [
                    {
                      "include": "#typenames"
                    },
                    {
                      "include": "#comma"
                    }
                  ]
                },
                {
                  "include": "#identifier"
                },
                {
                  "include": "#assignment"
                },
                {
                  "include": "#control-keywords"
                },
                {
                  "include": "#arrays"
                }
              ]
            }
          ]
        }
      ]
    },
    "method-member-access": {
      "match": "(([_a-zA-Z][_a-zA-Z0-9]*\\.)+([_a-zA-Z][_a-zA-Z0-9]*))",
      "beginCaptures": {
        "1": {
          "name": "entity.name.class.epl"
        },
        "2": {
          "name": "entity.name.function.epl"
        },
        "3": {
          "name": "entity.name.function.epl"
        }
      }
    },
    "codeblock": {
      "begin": "\\{",
      "end": "(?=\\})",
      "patterns":[
        {
          "include":"#method-member-access"
        },
        {
          "include": "#types"
        }
      ]
    },
    "statement": {
      "begin": "(?=[_a-zA-Z][_a-zA-Z0-9]*)\\s*",
      "end": "(?=\\;)",
      "patterns":[
        {
          "include":"#method-member-access"
        },
        {
          "include": "#types"
        }
      ]
    },
    "strings": {
      "name": "string.quoted.double.epl",
      "begin": "\"",
      "end": "\"",
      "patterns": [
        {
          "name": "constant.character.escape.epl",
          "match": "\\\\."
        }
      ]
    },
    "arrays": {
      "begin": "\\[",
      "end": "\\]",
      "patterns": [
        {
          "include": "#comma"
        },
        {
          "include": "#identifier"
        }
      ]
    },
    "comments": {
      "patterns": [
        {
          "comment": "Block Comments",
          "begin": "/\\*",
          "end": "\\*/",
          "name": "comment.block.epl"
        },
        {
          "comment": "Comment lines",
          "match": "(//.*)",
          "name": "comment.line.epl"
        }
      ]
    },
    "typenames": {
      "patterns": [
        {
          "comment": "for parameters and templates",
          "match": "\\b(integer|string|boolean|float|any|dictionary|sequence|context|channel)",
          "name": "storage.type.epl"
        }
      ]
    },
    "control-keywords": {
      "patterns": [
        {
          "comment": "Control keywords",
          "match": "(\\b(import|on|die|as|spawn|return|for|new|at|if|else|then|not|log|self|and|or|on|all|in|route|emit|enqueue|send)\\b)",
          "name": "keyword.control.epl"
        }
      ]
    },
    "constants": {
      "patterns": [
        {
          "comment": "Constants in EPL",
          "match": "\\b(true|false|constant)\\b",
          "name": "constant.language.epl"
        }
      ]
    },
    "logging": {
      "patterns": [
        {
          "comment": "Logging and numeric constants",
          "match": "\\b(\\d+|DEBUG|WARN|INFO|ERROR|CRIT)\\b",
          "name": "constant.language.epl"
        }
      ]
    },
    "comma": {
      "patterns": [
        {
          "comment": "comma symbol",
          "match": "(\\,)",
          "name": "keyword.operator"
        }
      ]
    },
    "operators": {
      "patterns": [
        {
          "comment": "operator symbol",
          "match": "(\\<|\\>|\\=|\\||\\!)",
          "name": "keyword.operator"
        }
      ]
    },
    "assignment": {
      "patterns": [
        {
          "comment": ":= assignment symbol",
          "match": "(\\:\\=)",
          "name": "keyword.operator"
        }
      ]
    },
    "identifier": {
      "comment": "IDENTIFIER - LAST match",
      "match": "\\b([_a-zA-Z][_a-zA-Z0-9]*)\\b",
      "name": "variable.language.epl"
    }
  },
  "scopeName": "source.epl"
}
